---
title: "Interactive Plots"
author: "Matt Eldridge"
date: '`r format(Sys.time(), "Last modified: %d %b %Y")`'
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Introduction

In this section we briefly introduce creating Shiny applications with interactive plots. These are figures where clicking on a point within a plot will trigger a selection event that causes an update to another part of the application.

We will show how this can be achieved with static plots generated by ggplot2 and also with HighCharts which allows for even more interactivity including zooming and tooltips.

For the examples shown here we use the results of a differential expression analysis using [limma](https://bioconductor.org/packages/release/bioc/html/limma.html), comparing ER negative and positive status groups.

### ggplot2 figures

The following Shiny application shows a Volcano plot of the log p-value versus the log fold change.

Here we add a `click` argument to `plotOutput` to listen to mouse click events. You can also listen to double-click and hover (mouse-over) events in exactly the same way.

```{r message = FALSE}
library(shiny)
library(tidyverse)

differentialExpressionResults <-
  read.csv("NKI-DE-results.csv") %>%
  mutate(minusLog10Pvalue = -log10(adj.P.Val))

ui <- fluidPage(
  fluidRow(
    column(
      width = 6,
      plotOutput("volcanoPlot", click = "volcanoPlotClick")
    ),
    column(
      width = 6,
      verbatimTextOutput("info")
    )
  )
)

server <- function(input, output) {

  output$volcanoPlot <- renderPlot({
    differentialExpressionResults %>%
      ggplot(aes(x = logFC, y = minusLog10Pvalue)) +
      geom_point() +
      xlab("log fold change") +
      ylab("-log10(P-value)")
  })

  output$info <- renderPrint({
    nearPoints(differentialExpressionResults, input$volcanoPlotClick) %>%
      transmute(
        Probe = probe,
        Gene = HUGO.gene.symbol,
        logFC = signif(logFC, digits = 2),
        adj.P.Val = signif(adj.P.Val, digits = 2)
      ) %>%
      remove_rownames()
  })
}

shinyApp(ui, server)
```

*Exercise*

Try changing the code above to handle mouse-over (hover) and brush events (brushing involves drawing a box in the plot area) instead of mouse clicks.


